# コンパイルについて

ソースコードはそのままではコンピュータが理解できません。これをコンピュータが理解できる機械語に翻訳する作業が「コンパイル」です。コンパイルには「コンパイラ」というツールを使います。コンパイラは言語によって様々ですが、C 言語なら cc, gcc が一般的です。C++ 言語なら cpp, c++, g++ などが一般的です。

```text
 +-------------+
 | Source code |
 | (example.c) |
 +------+------+
        |
        | compiling
        v
 +-------------+
 | Object file |
 | (example.o) |
 +------+------+
        |
        | linking
        v
+-----------------+
| Execution file  |
| (example)       |
+-----------------+
```

機械語とは、コンピュータが直接理解できる「0 と 1 の言葉」です。例えば C 言語やその他の言語は人間にとって読みやすいけど、コンピュータはそのままでは理解できません。だから、ソースコードをコンパイラというツールで機械語に翻訳して、コンピュータが動ける形にする必要があります。

機械語は、こんな感じの数字の並びです:

```text
10101000 11000000 00000010 00101101 ...
```

ちなみに、人間が書きやすいソースコードの状態を「高水準言語」と呼んで、機械語みたいにコンピュータが直接理解できるものを「低水準言語」と呼びます。

## 単一ファイルのコンパイル

C のソースコードが単一のファイルの場合の例。

### サンプルファイル (01helloworld.c)

```C
#include <stdio.h>

void main() {
    printf("Hello C World!\n");
}
```

† `main()` がこのコードのエントリポイントになります。

### コンパイル (01helloworld)

```shell
cc 01helloworld.c -o 01helloworld
```

### 実行 (01helloworld)

```shell
./01helloworld
```

## 複数ファイルのコンパイル

C のソースコードが複数ファイルの場合、`.c` だけでなく `.h` というヘッダファイルが必要になります。

ヘッダファイルは、複数のファイルで共有される関数や変数のプロトタイプ (宣言) を記述したファイルです。ヘッダファイルを読み込むことで、他のファイルからそのクラスや構造体や関数や変数を使用することができます。ヘッダファイルは、プログラムのモジュール化を促進し、コードの再利用性を高めることや、責務の分離など様々な理由から `.c` ファイルを複数にします。

```text
+-------------------+
| file1.c           |
|-------------------|   +------------------+
| include "file2.h" |<--| file2.h          |
| void main() {     |   |------------------|
|   c = hoge(a, b); |   | void hoge(x, y); |<--.
| }                 |   +------------------+   |
+-------------------+                          |
                      +--------------------+   |
                      | file2.c            |   |
                      |--------------------|   |
                      | include "file2.h"  |   |
                      | void hoge(x, y) {  |---'
                      |   return x + y;    |
                      | }                  |
                      +--------------------+
```

この例では、file1.c がエントリポイントの責務をもち、file2.c が計算の責務をもちます。

### サンプルファイル (02helloworld.c)

```C
#include <stdio.h>
#include "hello.h"

int main() {
    printf("Hello from 02helloworld!\n");
    print_hello(); // この関数は別のファイルに存在
    return 0;
}
```

† `main()` がこのコードのエントリポイントになります。

### サンプルファイル (02hello.c)

```C
#include <stdio.h>
#include "02hello.h"

void print_hello() {
    printf("Hello from 02hello.c!\n");
}
```

### サンプルファイル (02hello.h)

```C
#ifndef HELLO_H
#define HELLO_H

void print_hello();

#endif // HELLO_H
```

### コンパイル (.o ファイル)

オブジェクトファイルは、コンパイルによって生成される中間ファイルです。ソースコードが機械語に変換された状態ですが、まだ実行可能な状態ではありません。オブジェクトファイルには、関数や変数の定義、そしてそれらの相対的な位置情報などが含まれています。

```shell
cc -c 02helloworld.c -o 02helloworld.o
cc -c 02hello.c -o 02hello.o
```

### コンパイル (リンキング)

cc にはリンカーと呼ばれる機能があります。リンカーは、複数のオブジェクトファイルを結合し、一つの実行可能なプログラムを作成します。リンカーは、各オブジェクトファイルで定義された関数や変数の参照を解決し、それらを正しい位置に配置します。また、標準ライブラリなどの外部ライブラリとのリンクも行います。

```shell
cc 02helloworld.o 02hello.o -o 02helloworld
```

### 実行 (02helloworld)

```shell
./02helloworld
```

## おまけ: インタプリタとコンパイル

Perl, PHP, Python, Ruby のようにソースコードからそのまま実行できるものをインタプリタ言語と呼びますが、実際には実行時にソースコードを上から順にコンパイルしています。

実行前に事前にコンパイルするものを「コンパイル言語」と分類し、実行時に順次コンパイルするものを「インタプリタ言語」と分類します。

### コンパイル言語の代表

- C, C++
- C#, JAVA, Kotlin
- Go
- Rust
- Swift

など多数。

### インタプリタ言語の代表

- Perl
- PHP
- Python
- Ruby

など多数。
